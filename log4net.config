<?xml version="1.0" encoding="utf-8" ?>
<log4net>
  <!-- Appenders -->
  
  <!-- Console Appender for debugging -->
  <appender name="ConsoleAppender" type="log4net.Appender.ConsoleAppender">
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date [%level] %logger: %message%newline" />
    </layout>
  </appender>

  <!-- Rolling File Appender for standard logging -->
  <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="%env{APPDATA}\CursorPhobia\Logs\cursorphobia-%property{shortdate}.log" />
    <appendToFile value="true" />
    <rollingStyle value="Size" />
    <maxSizeRollBackups value="5" />
    <maximumFileSize value="10MB" />
    <staticLogFileName value="false" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date [%level] %logger - %message%newline%exception" />
    </layout>
  </appender>

  <!-- JSON Rolling File Appender for structured logging -->
  <appender name="JsonRollingFileAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="%env{APPDATA}\CursorPhobia\Logs\cursorphobia-structured-%property{shortdate}.json" />
    <appendToFile value="true" />
    <rollingStyle value="Size" />
    <maxSizeRollBackups value="5" />
    <maximumFileSize value="10MB" />
    <staticLogFileName value="false" />
    <layout type="CursorPhobia.Core.Logging.JsonPatternLayout, CursorPhobia.Core">
      <!-- JSON layout will be implemented as a custom layout -->
    </layout>
  </appender>

  <!-- Performance-specific appender -->
  <appender name="PerformanceAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="%env{APPDATA}\CursorPhobia\Logs\cursorphobia-performance-%property{shortdate}.log" />
    <appendToFile value="true" />
    <rollingStyle value="Size" />
    <maxSizeRollBackups value="3" />
    <maximumFileSize value="5MB" />
    <staticLogFileName value="false" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date [PERF] %logger - %message | Duration=%property{Duration}ms | Success=%property{Success} | Operation=%property{Operation}%newline" />
    </layout>
    <filter type="log4net.Filter.PropertyFilter">
      <key value="LogType" />
      <stringToMatch value="Performance" />
    </filter>
    <filter type="log4net.Filter.DenyAllFilter" />
  </appender>

  <!-- Window Operations appender -->
  <appender name="WindowOperationAppender" type="log4net.Appender.RollingFileAppender">
    <file type="log4net.Util.PatternString" value="%env{APPDATA}\CursorPhobia\Logs\cursorphobia-windows-%property{shortdate}.log" />
    <appendToFile value="true" />
    <rollingStyle value="Size" />
    <maxSizeRollBackups value="3" />
    <maximumFileSize value="5MB" />
    <staticLogFileName value="false" />
    <layout type="log4net.Layout.PatternLayout">
      <conversionPattern value="%date [WINDOW] %logger - %message | Handle=%property{WindowHandle} | Title=%property{WindowTitle} | Operation=%property{Operation}%newline" />
    </layout>
    <filter type="log4net.Filter.PropertyFilter">
      <key value="LogType" />
      <stringToMatch value="WindowOperation" />
    </filter>
    <filter type="log4net.Filter.DenyAllFilter" />
  </appender>

  <!-- Async wrapper for better performance -->
  <appender name="AsyncRollingFileAppender" type="log4net.Appender.AsyncAppender">
    <appender-ref ref="RollingFileAppender" />
    <bufferSize value="512" />
    <fix value="LocationInfo,ThreadName,Message,Exception" />
  </appender>

  <appender name="AsyncJsonAppender" type="log4net.Appender.AsyncAppender">
    <appender-ref ref="JsonRollingFileAppender" />
    <bufferSize value="512" />
    <fix value="LocationInfo,ThreadName,Message,Exception" />
  </appender>

  <appender name="AsyncPerformanceAppender" type="log4net.Appender.AsyncAppender">
    <appender-ref ref="PerformanceAppender" />
    <bufferSize value="256" />
    <fix value="ThreadName,Message" />
  </appender>

  <appender name="AsyncWindowAppender" type="log4net.Appender.AsyncAppender">
    <appender-ref ref="WindowOperationAppender" />
    <bufferSize value="256" />
    <fix value="ThreadName,Message" />
  </appender>

  <!-- Root logger -->
  <root>
    <level value="INFO" />
    <appender-ref ref="ConsoleAppender" />
    <appender-ref ref="AsyncRollingFileAppender" />
    <appender-ref ref="AsyncJsonAppender" />
    <appender-ref ref="AsyncPerformanceAppender" />
    <appender-ref ref="AsyncWindowAppender" />
  </root>

  <!-- Logger-specific configurations -->
  
  <!-- Reduce Microsoft/System noise -->
  <logger name="Microsoft" additivity="false">
    <level value="WARN" />
    <appender-ref ref="AsyncRollingFileAppender" />
  </logger>
  
  <logger name="System" additivity="false">
    <level value="WARN" />
    <appender-ref ref="AsyncRollingFileAppender" />
  </logger>

  <!-- CursorPhobia specific loggers -->
  <logger name="CursorPhobia" additivity="false">
    <level value="DEBUG" />
    <appender-ref ref="ConsoleAppender" />
    <appender-ref ref="AsyncRollingFileAppender" />
    <appender-ref ref="AsyncJsonAppender" />
    <appender-ref ref="AsyncPerformanceAppender" />
    <appender-ref ref="AsyncWindowAppender" />
  </logger>

  <!-- Performance-critical components with optimized logging -->
  <logger name="CursorPhobia.Core.Services.WindowPusher" additivity="false">
    <level value="INFO" />
    <appender-ref ref="AsyncRollingFileAppender" />
    <appender-ref ref="AsyncPerformanceAppender" />
    <appender-ref ref="AsyncWindowAppender" />
  </logger>

  <logger name="CursorPhobia.Core.Services.CursorTracker" additivity="false">
    <level value="INFO" />
    <appender-ref ref="AsyncRollingFileAppender" />
    <appender-ref ref="AsyncPerformanceAppender" />
  </logger>

</log4net>