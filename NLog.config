<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Warn"
      internalLogFile="${temp}/internal-nlog-CursorPhobia.txt">

  <!-- Enable async processing for better performance -->
  <targets async="true">
    
    <!-- File Target: Production logging with rotation -->
    <target xsi:type="File" 
            name="fileTarget"
            fileName="${specialfolder:folder=ApplicationData}/CursorPhobia/Logs/cursorphobia-${shortdate}.log"
            layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${exception:format=tostring}"
            archiveFileName="${specialfolder:folder=ApplicationData}/CursorPhobia/Logs/archives/cursorphobia-{#}.log"
            archiveAboveSize="10485760"
            archiveNumbering="Rolling"
            maxArchiveFiles="5"
            keepFileOpen="true"
            openFileCacheTimeout="30"
            concurrentWrites="true" />

    <!-- JSON File Target: Structured logging for production analysis -->
    <target xsi:type="File" 
            name="jsonFileTarget"
            fileName="${specialfolder:folder=ApplicationData}/CursorPhobia/Logs/cursorphobia-structured-${shortdate}.json"
            archiveFileName="${specialfolder:folder=ApplicationData}/CursorPhobia/Logs/archives/cursorphobia-structured-{#}.json"
            archiveAboveSize="10485760"
            archiveNumbering="Rolling"
            maxArchiveFiles="5"
            keepFileOpen="true"
            openFileCacheTimeout="30"
            concurrentWrites="true">
      <layout xsi:type="JsonLayout" includeAllProperties="true">
        <attribute name="timestamp" layout="${longdate}" />
        <attribute name="level" layout="${uppercase:${level}}" />
        <attribute name="logger" layout="${logger}" />
        <attribute name="message" layout="${message}" />
        <attribute name="serviceName" layout="${event-properties:ServiceName}" />
        <attribute name="operation" layout="${event-properties:Operation}" />
        <attribute name="duration" layout="${event-properties:Duration}" />
        <attribute name="success" layout="${event-properties:Success}" />
        <attribute name="logType" layout="${event-properties:LogType}" />
        <attribute name="windowHandle" layout="${event-properties:WindowHandle}" />
        <attribute name="windowTitle" layout="${event-properties:WindowTitle}" />
        <attribute name="systemComponent" layout="${event-properties:SystemComponent}" />
        <attribute name="event" layout="${event-properties:Event}" />
        <attribute name="exception" layout="${exception:format=@}" condition="${exception} != null" />
      </layout>
    </target>

    <!-- Console Target: Always enabled for debugging -->
    <target xsi:type="Console" 
            name="consoleTarget"
            layout="${time} [${uppercase:${level:padding=-5}}] ${logger:shortName=true}: ${message} ${exception:format=tostring}" />

  </targets>

  <!-- Logging Rules -->
  <rules>
    
    <!-- Console logging: Always enabled -->
    <logger name="*" minlevel="Debug" writeTo="consoleTarget" />

    <!-- JSON structured logging: All levels for production analysis -->
    <logger name="*" minlevel="Info" writeTo="jsonFileTarget" />

    <!-- Standard file logging: All levels -->
    <logger name="*" minlevel="Debug" writeTo="fileTarget" />

    <!-- Special handling for Microsoft and System logs: Reduce noise -->
    <logger name="Microsoft.*" maxlevel="Warning" final="true" />
    <logger name="System.*" maxlevel="Warning" final="true" />

  </rules>

  <!-- Extensions for better performance -->
  <extensions>
    <add assembly="NLog.Extensions.Logging" />
  </extensions>

</nlog>